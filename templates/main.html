{% load static %}
<html>
    <head>
         <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <!-- Record RTC -->
        <script src="https://github.com/muaz-khan/RecordRTC/releases/download/5.4.5/RecordRTC.js"></script>
        
        <link rel="stylesheet" href="{% static 'css/circle.css' %}">
        
    </head>
    <body>
        <center>
        <div class="container">
                <div class="row">
                    <h2> Кажете ја вашата фраза: </h2>
                    <img onclick="recordAudio()" src="{% static 'mic.png' %}" width=200 height=200>
                    <button id="stopRecording">STOP</button>
                    <div id="load">   
                        <div>А</div>                            
                        <div>М</div>
                        <div>И</div>
                        <div>Н</div>
                        <div>С</div>
                    </div>
                </div>
        </div>
        </center>
    </body>
    <script>

var recordRTC;

function successCallback(audioStream) {
var options = {
    type: 'audio',
    recorderType: StereoAudioRecorder,
    sampleRate: 16000,
    desiredSampRate: 16000,
 };
 var recordRTC = RecordRTC(audioStream, options);
recordRTC.startRecording();
}
    

    function errorCallback(error) {
        console.log(error);
    // maybe another application is using the device
    }

    var mediaConstraints = { video: false, audio: true };

        function recordAudio() {
            // request permission to access audio stream
            navigator.mediaDevices.getUserMedia(mediaConstraints).then(successCallback).catch(errorCallback);
            
    //             // store streaming data chunks in array
    //             const chunks = [];
    //             // create media recorder instance to initialize recording
    //             const recorder = new MediaRecorder(stream);
    //             // function to be called when data is received
    //             recorder.ondataavailable = e => {
    //             // add stream data to chunks
    //             chunks.push(e.data);
    //             // if recorder is 'inactive' then recording has finished
    //             if (recorder.state == 'inactive') {
    //                 // convert stream data chunks to a 'webm' audio format as a blob
    //                 const blob = new Blob(chunks, { type: 'audio/wav' });
    //                 console.log(blob)
    //                 sendBlob(blob);
    //                 // convert blob to URL so it can be assigned to a audio src attribute
    //                 // createAudioElement(URL.createObjectURL(blob));
    //             }
    //             };
    //             // start recording with 1 second time between receiving 'ondataavailable' events
    //             recorder.start(1000);
    //             $('#load').show();
    //             setTimeout(() => {
    //     // this will trigger one final 'ondataavailable' event and set recorder state to 'inactive'
    //     recorder.stop();
    //     $('#load').hide();
    // }, 2000);
    //             // setTimeout to stop recording after 4 seconds
    //         }).catch(console.error);
        }

$('#stopRecording').click(function () {
    recordRTC.stopRecording(function (audioVideoWebMURL) {
        video.src = audioVideoWebMURL;

        var recordedBlob = recordRTC.getBlob();
        console.log("STIA");
        console.log(recordedBlob);
        recordRTC.getDataURL(function(dataURL) { });
    });
});
//*** RECORD AUDIO DEFAULT ***//
    //     var recording = false;
    //     function sendBlob(blob) {
    //         var fd = new FormData();
    //         fd.append('audio',blob);
    //         $.ajax({
    //             type: 'POST',
    //             url: '/main/',
    //             data: fd,
    //             processData: false,
    //             contentType: false
    //         }).done(function(data) {
    //             console.log(data);
    //         });
    //     }

    </script>
</html>