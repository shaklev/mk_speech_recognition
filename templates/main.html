{% load static %}
<html>
    <head>
         <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <!-- Record RTC -->
        <script src="https://github.com/muaz-khan/RecordRTC/releases/download/5.4.5/RecordRTC.js"></script>
        
        <link rel="stylesheet" href="{% static 'css/circle.css' %}">
        
    </head>
    <body>
        <center>
        <div class="container">
                <div class="row">
                    <h2> Кажете ја вашата фраза: </h2>
                    <img onclick="recordAudio()" src="{% static 'mic.png' %}" width=200 height=200>
                    <button id="stopRecording">STOP</button>
                    <div id="load">   
                        <div>А</div>                            
                        <div>М</div>
                        <div>И</div>
                        <div>Н</div>
                        <div>С</div>
                    </div>
                </div>
        </div>
        </center>
    </body>

    <script>

    var recordRTC;

    var mediaConstraints = { video: false, audio: true };

    // Initialize & start recording
    function recordAudio() {
        navigator.mediaDevices.getUserMedia(mediaConstraints).then(successCallback).catch(errorCallback);
    }

    // Record audio
    function successCallback(audioStream) {
    var options = {
        type: 'audio',
        recorderType: StereoAudioRecorder,
        sampleRate: 16000,
        desiredSampRate: 16000,
    };
    recordRTC = RecordRTC(audioStream, options);
    recordRTC.startRecording();
    }
    
    // Catch error
    function errorCallback(error) {
        console.log(error);
    }

    $('#stopRecording').click(function () {
        recordRTC.stopRecording(function(audioURL) {    
            var recordedBlob = recordRTC.getBlob();
            console.log(recordedBlob);
            sendBlob(recordedBlob);
            recordRTC.getDataURL(function(dataURL) { });
        });
    });

    // Send to server
    function sendBlob(blob) {
        var fd = new FormData();
        fd.append('audio',blob);
        $.ajax({
            type: 'POST',
            url: '/main/',
            data: fd,
            processData: false,
            contentType: false
        }).done(function(data) {
            console.log(data);
        });
    }

    </script>
</html>